#!/usr/bin/env python

import argparse
import os, subprocess

parser = argparse.ArgumentParser(description="Clean up regeneratable files generated by latex.")
parser.add_argument('-r', '--recursive', action='store_true', help="recurse on subfolders")
parser.add_argument('-s', '--silent', action='store_true', help="do not print filenames")
args = parser.parse_args()

exts = ['aux', 'bbl', 'blg', 'fdb_latexmk', 'fls', 'log', 'nav', 'out', 'snm', 'synctex(busy)', 'synctex.gz', 'toc']

for dirpath, _, filenames in os.walk('.'):
    removes = []
    for file in filenames:
        if file.endswith('.tex'):
            removes += (file[:-3] + ext for ext in exts)
        elif file.endswith('.eps'):
            removes.append(file[:-4] + '-eps-converted-to.pdf')
    filenames = set(filenames)
    if removes := [f for f in removes if f in filenames]:
        subprocess.run(['trash', *(os.path.join(dirpath, f) for f in removes)])
        if not args.silent:
            print(f"{dirpath}:")
            print(*(f"    {f}" for f in removes), sep='\n')
    if not args.recursive:
        break
